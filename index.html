<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Jhopan VPN - Free VPN Configuration Generator</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 3em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.9;
      }

      .card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      }

      .card h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.8em;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
      }

      select,
      input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 1em;
        transition: border-color 0.3s;
      }

      select:focus,
      input:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 40px;
        border: none;
        border-radius: 50px;
        font-size: 1.1em;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        margin-top: 10px;
        transition: transform 0.3s;
      }

      .btn:hover {
        transform: translateY(-3px);
      }

      .btn:active {
        transform: translateY(0);
      }

      .result-box {
        background: #f8f9fa;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        display: none;
      }

      .result-box.show {
        display: block;
      }

      .result-box textarea {
        width: 100%;
        min-height: 200px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 0.9em;
        resize: vertical;
      }

      .copy-btn {
        background: #28a745;
        margin-top: 10px;
      }

      .copy-btn:hover {
        background: #218838;
      }

      .features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .feature {
        text-align: center;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
      }

      .feature-icon {
        font-size: 3em;
        margin-bottom: 10px;
      }

      .feature-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
      }

      .feature-desc {
        color: #666;
        font-size: 0.9em;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .loading.show {
        display: block;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .quick-links {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 20px;
      }

      .quick-link {
        background: #e9ecef;
        padding: 8px 16px;
        border-radius: 20px;
        text-decoration: none;
        color: #495057;
        font-size: 0.9em;
        transition: background 0.3s;
      }

      .quick-link:hover {
        background: #dee2e6;
      }

      .server-item {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .server-item:hover {
        border-color: #667eea;
        transform: translateX(5px);
      }

      .server-item.selected {
        border-color: #667eea;
        background: #f0f4ff;
      }

      .server-info {
        flex: 1;
      }

      .server-name {
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
      }

      .server-details {
        font-size: 0.85em;
        color: #666;
      }

      .server-ping {
        background: #28a745;
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9em;
        min-width: 80px;
        text-align: center;
      }

      .server-ping.medium {
        background: #ffc107;
      }

      .server-ping.slow {
        background: #dc3545;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸš€ Jhopan VPN</h1>
        <p>Free VPN Configuration Generator</p>
      </div>

      <div class="card">
        <h2>ğŸ“¥ Select VPN Server</h2>

        <div class="form-group">
          <label for="country">ğŸŒ Select Country:</label>
          <select id="country" onchange="loadServers()">
            <option value="ID">ğŸ‡®ğŸ‡© Indonesia</option>
            <option value="SG">ğŸ‡¸ğŸ‡¬ Singapore</option>
            <option value="US">ğŸ‡ºğŸ‡¸ United States</option>
            <option value="JP">ğŸ‡¯ğŸ‡µ Japan</option>
            <option value="KR">ğŸ‡°ğŸ‡· South Korea</option>
            <option value="HK">ğŸ‡­ğŸ‡° Hong Kong</option>
            <option value="DE">ğŸ‡©ğŸ‡ª Germany</option>
            <option value="FR">ğŸ‡«ğŸ‡· France</option>
            <option value="GB">ğŸ‡¬ğŸ‡§ United Kingdom</option>
            <option value="NL">ğŸ‡³ğŸ‡± Netherlands</option>
            <option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option>
            <option value="AU">ğŸ‡¦ğŸ‡º Australia</option>
            <option value="BR">ğŸ‡§ğŸ‡· Brazil</option>
            <option value="IN">ğŸ‡®ğŸ‡³ India</option>
            <option value="MY">ğŸ‡²ğŸ‡¾ Malaysia</option>
            <option value="TH">ğŸ‡¹ğŸ‡­ Thailand</option>
            <option value="VN">ğŸ‡»ğŸ‡³ Vietnam</option>
            <option value="TR">ğŸ‡¹ğŸ‡· Turkey</option>
          </select>
        </div>

        <div class="form-group">
          <label for="protocol">ğŸ” Protocol:</label>
          <select id="protocol">
            <option value="vless">VLESS (Recommended)</option>
            <option value="trojan">Trojan</option>
            <option value="ss">Shadowsocks</option>
          </select>
        </div>

        <div class="form-group">
          <label for="security">ğŸ”’ Security:</label>
          <select id="security">
            <option value="443">TLS (Port 443) - Recommended</option>
            <option value="80">NTLS (Port 80) - No Encryption</option>
          </select>
        </div>

        <button class="btn" onclick="loadServers()">
          ğŸ” Show Available Servers
        </button>

        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p style="margin-top: 10px">Loading servers...</p>
        </div>

        <div class="result-box" id="serverList" style="display: none">
          <h3 style="margin-bottom: 15px">ğŸ“¡ Available Servers</h3>
          <div id="servers"></div>
        </div>

        <div class="result-box" id="resultBox">
          <h3 style="margin-bottom: 10px">âœ… Selected Config</h3>
          <div
            style="
              background: white;
              padding: 15px;
              border-radius: 8px;
              margin-bottom: 15px;
            "
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
              "
            >
              <strong id="selectedServer" style="color: #667eea"
                >No server selected</strong
              >
              <span
                id="selectedPing"
                style="
                  background: #28a745;
                  color: white;
                  padding: 4px 12px;
                  border-radius: 15px;
                  font-size: 0.85em;
                "
              ></span>
            </div>
            <div
              style="font-size: 0.9em; color: #666"
              id="selectedDetails"
            ></div>
          </div>

          <div class="form-group">
            <label for="format">ğŸ“‹ Convert to Format:</label>
            <select id="format" onchange="convertFormat()">
              <option value="raw">Raw Links (Universal)</option>
              <option value="v2ray">Base64 (V2Ray/V2RayNG)</option>
              <option value="clash">Clash YAML</option>
              <option value="sfa">Sing-Box JSON</option>
            </select>
          </div>

          <textarea id="configResult" readonly></textarea>
          <button class="btn copy-btn" onclick="copyConfig()">
            ğŸ“‹ Copy Config
          </button>
          <div class="quick-links">
            <a href="#" class="quick-link" onclick="openV2Ray()"
              >Open in V2RayN</a
            >
            <a href="#" class="quick-link" onclick="downloadConfig()"
              >ğŸ’¾ Download</a
            >
          </div>
        </div>
      </div>

      <div class="card">
        <h2>âœ¨ Features</h2>
        <div class="features">
          <div class="feature">
            <div class="feature-icon">ğŸŒ</div>
            <div class="feature-title">51 Countries</div>
            <div class="feature-desc">Global server coverage</div>
          </div>
          <div class="feature">
            <div class="feature-icon">âš¡</div>
            <div class="feature-title">High Speed</div>
            <div class="feature-desc">Optimized connections</div>
          </div>
          <div class="feature">
            <div class="feature-icon">ğŸ”’</div>
            <div class="feature-title">Secure</div>
            <div class="feature-desc">Encrypted traffic</div>
          </div>
          <div class="feature">
            <div class="feature-icon">ğŸ’¯</div>
            <div class="feature-title">100% Free</div>
            <div class="feature-desc">No subscription needed</div>
          </div>
        </div>
      </div>

      <div class="card" style="text-align: center; color: #666">
        <p>Powered by Cloudflare Workers | Built with â¤ï¸ by Jhopan</p>
        <p style="margin-top: 10px; font-size: 0.9em">
          <a
            href="https://github.com/jhopan/Wokers-Jhopan"
            style="color: #667eea; text-decoration: none"
            >ğŸ“¦ GitHub Repository</a
          >
        </p>
      </div>
    </div>

    <script>
      // Get worker domain from URL parameter or use default
      const urlParams = new URLSearchParams(window.location.search);
      const workerDomain = urlParams.get("host") || "jhopan.my.id";

      let serverData = [];
      let selectedServerIndex = -1;

      async function loadServers() {
        const country = document.getElementById("country").value;
        const protocol = document.getElementById("protocol").value;
        const port = document.getElementById("security").value;

        // Show loading
        document.getElementById("loading").classList.add("show");
        document.getElementById("serverList").style.display = "none";
        document.getElementById("resultBox").classList.remove("show");

        try {
          // Always fetch RAW format first for server list
          const apiUrl = `https://${workerDomain}/api/v1/sub?cc=${country}&vpn=${protocol}&port=${port}&limit=50&format=raw`;
          const response = await fetch(apiUrl);
          const configText = await response.text();

          // Parse raw configs
          const configs = configText.split("\n").filter((line) => line.trim());
          serverData = configs.map((config, index) => {
            const decoded = decodeURIComponent(config);
            const hashMatch = decoded.match(/#(.+)$/);
            const serverName = hashMatch ? hashMatch[1] : `Server ${index + 1}`;

            // Extract server IP/details
            const pathMatch = decoded.match(/path=([^&]+)/);
            const serverIP = pathMatch
              ? decodeURIComponent(pathMatch[1]).replace("/", "")
              : "";

            // Simulate ping based on region (lower for closer regions)
            const ping = simulatePing(country);

            return {
              config: config,
              name: serverName,
              ip: serverIP,
              ping: ping,
              country: country,
            };
          });

          // Sort by ping (fastest first)
          serverData.sort((a, b) => a.ping - b.ping);

          // Display servers
          displayServers();

          document.getElementById("loading").classList.remove("show");
          document.getElementById("serverList").style.display = "block";
        } catch (error) {
          alert("Error loading servers: " + error.message);
          document.getElementById("loading").classList.remove("show");
        }
      }

      function simulatePing(countryCode) {
        // Simulate realistic ping based on country
        const pingRanges = {
          ID: [5, 25],
          SG: [15, 35],
          MY: [10, 30],
          TH: [20, 40],
          VN: [25, 45],
          JP: [35, 60],
          KR: [40, 65],
          HK: [30, 55],
          US: [150, 220],
          CA: [180, 250],
          GB: [200, 280],
          DE: [180, 260],
          FR: [190, 270],
          NL: [185, 265],
          AU: [120, 180],
          BR: [220, 320],
          IN: [45, 85],
          TR: [160, 240],
        };

        const range = pingRanges[countryCode] || [100, 200];
        return Math.floor(Math.random() * (range[1] - range[0] + 1)) + range[0];
      }

      function displayServers() {
        const serversDiv = document.getElementById("servers");
        serversDiv.innerHTML = "";

        serverData.forEach((server, index) => {
          const pingClass =
            server.ping < 50 ? "" : server.ping < 100 ? "medium" : "slow";

          const serverDiv = document.createElement("div");
          serverDiv.className = "server-item";
          serverDiv.onclick = () => selectServer(index);

          serverDiv.innerHTML = `
                    <div class="server-info">
                        <div class="server-name">${server.name}</div>
                        <div class="server-details">ğŸ“ ${server.ip}</div>
                    </div>
                    <div class="server-ping ${pingClass}">${server.ping}ms</div>
                `;

          serversDiv.appendChild(serverDiv);
        });
      }

      function selectServer(index) {
        selectedServerIndex = index;
        const server = serverData[index];

        // Update UI
        document.querySelectorAll(".server-item").forEach((item, i) => {
          if (i === index) {
            item.classList.add("selected");
          } else {
            item.classList.remove("selected");
          }
        });

        // Show config
        const port = document.getElementById("security").value;
        const securityType = port === "443" ? "TLS" : "NTLS";

        document.getElementById("selectedServer").textContent = server.name;
        document.getElementById(
          "selectedPing"
        ).textContent = `${server.ping}ms`;
        document.getElementById("selectedDetails").innerHTML = `
                ğŸ“ Server: <code>${server.ip}</code><br>
                ğŸŒ Country: ${getCountryName(server.country)}<br>
                ğŸ” Protocol: ${document
                  .getElementById("protocol")
                  .value.toUpperCase()}<br>
                ğŸ”’ Security: ${securityType} (Port ${port})
            `;

        // Reset format to raw and show raw config
        document.getElementById("format").value = "raw";
        document.getElementById("configResult").value = server.config;
        document.getElementById("resultBox").classList.add("show");

        // Scroll to result
        document
          .getElementById("resultBox")
          .scrollIntoView({ behavior: "smooth", block: "nearest" });
      }

      async function convertFormat() {
        if (selectedServerIndex === -1) return;

        const server = serverData[selectedServerIndex];
        const format = document.getElementById("format").value;
        const port = document.getElementById("security").value;
        const securityType = port === "443" ? "TLS" : "NTLS";

        // Update details to show current format
        document.getElementById("selectedDetails").innerHTML = `
                ğŸ“ Server: <code>${server.ip}</code><br>
                ğŸŒ Country: ${getCountryName(server.country)}<br>
                ğŸ” Protocol: ${document
                  .getElementById("protocol")
                  .value.toUpperCase()}<br>
                ğŸ”’ Security: ${securityType} (Port ${port})<br>
                ğŸ“‹ Format: ${format.toUpperCase()}
            `;

        if (format === "raw") {
          // Show original raw config
          document.getElementById("configResult").value = server.config;
          return;
        }

        // Convert to other formats using converter API
        try {
          const converterUrl = "https://api.foolvpn.web.id/convert";
          
          const response = await fetch(converterUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              url: server.config,
              format: format,
              template: "cf"
            })
          });

          if (response.ok) {
            const convertedConfig = await response.text();
            document.getElementById("configResult").value = convertedConfig;
          } else {
            document.getElementById("configResult").value = `Error: ${response.status} - ${response.statusText}\n\nTry using Raw format instead.`;
          }
        } catch (error) {
          document.getElementById("configResult").value = `Conversion failed: ${error.message}\n\nRaw config:\n${server.config}`;
        }
      }

      function getCountryName(code) {
        const countries = {
          ID: "ğŸ‡®ğŸ‡© Indonesia",
          SG: "ğŸ‡¸ğŸ‡¬ Singapore",
          US: "ğŸ‡ºğŸ‡¸ United States",
          JP: "ğŸ‡¯ğŸ‡µ Japan",
          KR: "ğŸ‡°ğŸ‡· South Korea",
          HK: "ğŸ‡­ğŸ‡° Hong Kong",
          DE: "ğŸ‡©ğŸ‡ª Germany",
          FR: "ğŸ‡«ğŸ‡· France",
          GB: "ğŸ‡¬ğŸ‡§ United Kingdom",
          NL: "ğŸ‡³ğŸ‡± Netherlands",
          CA: "ğŸ‡¨ğŸ‡¦ Canada",
          AU: "ğŸ‡¦ğŸ‡º Australia",
          BR: "ğŸ‡§ğŸ‡· Brazil",
          IN: "ğŸ‡®ğŸ‡³ India",
          MY: "ğŸ‡²ğŸ‡¾ Malaysia",
          TH: "ğŸ‡¹ğŸ‡­ Thailand",
          VN: "ğŸ‡»ğŸ‡³ Vietnam",
          TR: "ğŸ‡¹ğŸ‡· Turkey",
        };
        return countries[code] || code;
      }

      function copyConfig() {
        const textarea = document.getElementById("configResult");
        textarea.select();
        document.execCommand("copy");

        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = "âœ… Copied!";
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      }

      function openV2Ray() {
        const config = document.getElementById("configResult").value;
        const format = document.getElementById("format").value;

        // Only works for raw format
        if (format === "raw") {
          const firstLine = config.split("\n")[0];
          window.location.href = firstLine;
        } else {
          alert(
            "Direct open only works with Raw format. Please use Copy or Download instead."
          );
        }
        return false;
      }

      function downloadConfig() {
        const config = document.getElementById("configResult").value;
        const protocol = document.getElementById("protocol").value;
        const format = document.getElementById("format").value;
        const country = document.getElementById("country").value;

        // Determine file extension based on format
        let extension = "txt";
        if (format === "clash") extension = "yaml";
        else if (format === "sfa") extension = "json";
        else if (format === "v2ray") extension = "txt";

        const filename = `jhopan-${country}-${protocol}-${format}-${Date.now()}.${extension}`;

        const blob = new Blob([config], { type: "text/plain" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        a.click();
        window.URL.revokeObjectURL(url);
        return false;
      }

      // Auto-load on page load
      window.onload = () => {
        loadServers();
      };
    </script>
  </body>
</html>
